<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/L.Control.Locate.min.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        /* Estilos para los controles personalizados */
        .project-controls {
            position: absolute;
            top: 100px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }
        .project-controls select, .project-controls button {
            margin: 5px 0;
            padding: 5px;
            width: 100%;
        }
        .project-highlight {
            filter: drop-shadow(0 0 8px yellow);
        }
        </style>
        <title>SinCorredor.cl</title>
    </head>
    <body>
        <div id="map"></div>
        
        <!-- Controles personalizados para proyectos -->
        <div class="project-controls">
            <select id="project-selector">
                <option value="">-- Seleccione un Proyecto --</option>
                <!-- Las opciones se llenarán dinámicamente -->
            </select>
            <button id="reset-view">Vista Inicial</button>
        </div>

        <!-- Scripts originales -->
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/L.Control.Locate.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="data/Parcelas_2.js"></script>
        <script src="data/Proyectos_3.js"></script>
        <script>
        // Configuración inicial del mapa (igual que antes)
        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:1
        }).fitBounds([[-36.758916645231956,-72.86067052892878],[-36.10072985826496,-71.18813577080864]]);
        
        // ... (todo el código original hasta la creación de layer_Proyectos_3) ...

        // Guardar la vista inicial
        var initialBounds = [[-36.758916645231956,-72.86067052892878],[-36.10072985826496,-71.18813577080864]];
        
        // Crear un objeto para almacenar los marcadores de proyectos
        var proyectosMarkers = {};
        
        // Llenar el selector de proyectos y almacenar los marcadores
        function initProjectSelector() {
            var selector = document.getElementById('project-selector');
            
            // Limpiar opciones existentes
            selector.innerHTML = '<option value="">-- Seleccione un Proyecto --</option>';
            
            // Recorrer todos los proyectos y agregarlos al selector
            layer_Proyectos_3.eachLayer(function(layer) {
                var proyectoName = layer.feature.properties['Proyecto'] || 'Proyecto sin nombre';
                var proyectoId = 'proyecto-' + L.stamp(layer); // ID único
                
                // Agregar opción al selector
                var option = document.createElement('option');
                option.value = proyectoId;
                option.textContent = proyectoName;
                selector.appendChild(option);
                
                // Almacenar el marcador para referencia rápida
                proyectosMarkers[proyectoId] = layer;
            });
        }
        
        // Función para hacer zoom al proyecto seleccionado
        function zoomToProject(projectId) {
            // Quitar resaltado de todos los proyectos
            layer_Proyectos_3.eachLayer(function(layer) {
                layer._icon.classList.remove('project-highlight');
            });
            
            if (!projectId) return;
            
            var marker = proyectosMarkers[projectId];
            if (marker) {
                // Resaltar el proyecto seleccionado
                marker._icon.classList.add('project-highlight');
                
                // Hacer zoom al marcador con un pequeño padding
                map.flyToBounds(L.latLngBounds([
                    marker.getLatLng(),
                    marker.getLatLng()
                ]).pad(0.5), {
                    duration: 1,
                    maxZoom: 16
                });
            }
        }
        
        // Evento cuando se selecciona un proyecto
        document.getElementById('project-selector').addEventListener('change', function() {
            zoomToProject(this.value);
        });
        
        // Botón para volver a la vista inicial
        document.getElementById('reset-view').addEventListener('click', function() {
            // Quitar resaltado
            layer_Proyectos_3.eachLayer(function(layer) {
                layer._icon.classList.remove('project-highlight');
            });
            
            // Resetear el selector
            document.getElementById('project-selector').value = "";
            
            // Volver a la vista inicial
            map.flyToBounds(initialBounds);
        });
        
        // Inicializar el selector después de que se carguen los proyectos
        map.whenReady(function() {
            // Pequeño retraso para asegurar que los proyectos estén cargados
            setTimeout(initProjectSelector, 500);
        });

        // ... (resto del código original) ...
        </script>
    </body>
</html>
